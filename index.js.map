{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["const BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '53408779-ee8ac1d107b84f4a01a68d938Y';\nconst PER_PAGE = 15;\n\nexport async function getImagesByQuery(query, page = 1) {\n  const url = new URL(BASE_URL);\n  url.searchParams.set('key', API_KEY);\n  url.searchParams.set('q', query.trim());\n  url.searchParams.set('image_type', 'photo');\n  url.searchParams.set('orientation', 'horizontal');\n  url.searchParams.set('safesearch', 'true');\n  url.searchParams.set('per_page', String(PER_PAGE));\n  url.searchParams.set('page', String(page));\n\n  try {\n    const res = await fetch(url.toString());\n    if (!res.ok) {\n      throw new Error(`Pixabay API error: ${res.status}`);\n    }\n    const data = await res.json();\n\n    return data;\n  } catch (error) {\n    throw error;\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\n\nconst refs = {\n  gallery: document.querySelector('.gallery'),\n  loader: document.querySelector('#loader'),\n  loadMoreBtn: document.querySelector('#load-more'),\n};\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nfunction _show(el) {\n  if (el) el.classList.remove('is-hidden');\n}\nfunction _hide(el) {\n  if (el) el.classList.add('is-hidden');\n}\n\nexport function createGallery(images = []) {\n  if (!refs.gallery) return;\n\n  const markup = images\n    .map(hit => {\n      return `\n      <li class=\"photo-card\">\n        <a class=\"gallery__link\" href=\"${hit.largeImageURL}\">\n          <img class=\"gallery__image\" src=\"${hit.webformatURL}\" alt=\"${hit.tags}\" loading=\"lazy\" />\n        </a>\n        <div class=\"info\">\n          <p class=\"info-item\"><b>Likes</b><span>${hit.likes}</span></p>\n          <p class=\"info-item\"><b>Views</b><span>${hit.views}</span></p>\n          <p class=\"info-item\"><b>Comments</b><span>${hit.comments}</span></p>\n          <p class=\"info-item\"><b>Downloads</b><span>${hit.downloads}</span></p>\n        </div>\n      </li>`;\n    })\n    .join('');\n\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n\n  lightbox.refresh();\n}\n\nexport function clearGallery() {\n  if (!refs.gallery) return;\n  refs.gallery.innerHTML = '';\n}\n\nexport function showLoader() {\n  _show(refs.loader);\n}\n\nexport function hideLoader() {\n  _hide(refs.loader);\n}\n\nexport function showLoadMoreButton() {\n  _show(refs.loadMoreBtn);\n}\n\nexport function hideLoadMoreButton() {\n  _hide(refs.loadMoreBtn);\n}\n","import { getImagesByQuery } from './js/pixabay-api.js';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n} from './js/render-functions.js';\n\n// DOM refs\nconst refs = {\n  form: document.querySelector('#search-form'),\n  input: document.querySelector('#search-input'),\n  loadMoreBtn: document.querySelector('#load-more'),\n  gallery: document.querySelector('.gallery'),\n  loader: document.querySelector('#loader'),\n};\n\nlet currentQuery = '';\nlet currentPage = 1;\nconst PER_PAGE = 15; // має збігатися з pixabay-api.js\n\n// Ініціалізація стану UI\nhideLoadMoreButton();\nhideLoader();\n\nrefs.form.addEventListener('submit', onSearch);\nrefs.loadMoreBtn.addEventListener('click', onLoadMore);\n\nasync function onSearch(e) {\n  e.preventDefault();\n\n  const query = refs.input.value.trim();\n  if (!query) {\n    iziToast.warning({\n      title: 'Warning',\n      message: 'Please enter a search query.',\n    });\n    return;\n  }\n\n  // якщо новий запит — скидаємо сторінку і очищаємо галерею\n  const isNewSearch = query.toLowerCase() !== currentQuery.toLowerCase();\n  if (isNewSearch) {\n    currentPage = 1;\n    clearGallery();\n  }\n\n  currentQuery = query;\n\n  hideLoadMoreButton();\n  showLoader();\n\n  try {\n    const data = await getImagesByQuery(currentQuery, currentPage);\n    const { hits = [], totalHits = 0 } = data;\n\n    if (!hits.length) {\n      hideLoader();\n      iziToast.error({\n        title: 'No results',\n        message: `No images found for \"${currentQuery}\".`,\n      });\n      return;\n    }\n\n    // додаємо отримані зображення\n    createGallery(hits);\n\n    // якщо загальна кількість більша, ніж вже завантажено — показуємо кнопку\n    const totalLoaded = currentPage * PER_PAGE;\n    if (totalHits > totalLoaded) {\n      showLoadMoreButton();\n    } else {\n      hideLoadMoreButton();\n      iziToast.info({\n        title: 'End',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n    }\n\n    // Якщо це новий пошук, прокрутка не потрібна; якщо підвантажили наступну сторінку — зробимо прокрутку\n    if (!isNewSearch && hits.length) {\n      smoothScrollAfterAppend();\n    }\n\n    iziToast.success({\n      title: 'Success',\n      message: `Found ${totalHits} images.`,\n    });\n  } catch (err) {\n    console.error(err);\n    iziToast.error({\n      title: 'Error',\n      message: 'Something went wrong. Please try again.',\n    });\n  } finally {\n    hideLoader();\n  }\n}\n\nasync function onLoadMore() {\n  currentPage += 1;\n  showLoader();\n  hideLoadMoreButton(); // запобігти повторним клікам поки йде запит\n\n  try {\n    const data = await getImagesByQuery(currentQuery, currentPage);\n    const { hits = [], totalHits = 0 } = data;\n\n    if (!hits.length) {\n      hideLoader();\n      iziToast.info({\n        title: 'End',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n      hideLoadMoreButton();\n      return;\n    }\n\n    createGallery(hits);\n\n    const totalLoaded = currentPage * PER_PAGE;\n    if (totalHits > totalLoaded) {\n      showLoadMoreButton();\n    } else {\n      hideLoadMoreButton();\n      iziToast.info({\n        title: 'End',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n    }\n\n    // Прокрутка після додавання\n    smoothScrollAfterAppend();\n  } catch (err) {\n    console.error(err);\n    iziToast.error({ title: 'Error', message: 'Failed to load more images.' });\n  } finally {\n    hideLoader();\n  }\n}\n\nfunction smoothScrollAfterAppend() {\n  // Отримаємо висоту першої карточки\n  const firstCard = refs.gallery.querySelector('.photo-card');\n  if (!firstCard) return;\n\n  const { height } = firstCard.getBoundingClientRect();\n  // Прокрутка на дві висоти карточки\n  window.scrollBy({\n    top: height * 2,\n    behavior: 'smooth',\n  });\n}\n"],"names":["BASE_URL","API_KEY","PER_PAGE","getImagesByQuery","query","page","url","res","error","refs","lightbox","SimpleLightbox","_show","el","_hide","createGallery","images","markup","hit","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","currentQuery","currentPage","onSearch","onLoadMore","e","isNewSearch","data","hits","totalHits","totalLoaded","smoothScrollAfterAppend","err","firstCard","height"],"mappings":"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"}