{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["const BASE_URL = 'https://pixabay.com/api/';\n\nconst API_KEY = '53408779-ee8ac1d107b84f4a01a68d938';\nconst PER_PAGE = 15;\n\nexport async function getImagesByQuery(query, page = 1) {\n  const url = new URL(BASE_URL);\n  url.searchParams.set('key', API_KEY);\n  url.searchParams.set('q', query.trim());\n  url.searchParams.set('image_type', 'photo');\n  url.searchParams.set('orientation', 'horizontal');\n  url.searchParams.set('safesearch', 'true');\n  url.searchParams.set('per_page', String(PER_PAGE));\n  url.searchParams.set('page', String(page));\n\n  try {\n    const res = await fetch(url.toString());\n    if (!res.ok) {\n      throw new Error(`Pixabay API error: ${res.status} ${res.statusText}`);\n    }\n    const data = await res.json();\n\n    return data;\n  } catch (error) {\n    throw error;\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\n\nconst refs = {\n  gallery: document.querySelector('.gallery'),\n  loader: document.querySelector('#loader'),\n  loadMoreBtn: document.querySelector('#load-more'),\n};\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nfunction _show(el) {\n  if (el) el.classList.remove('is-hidden');\n}\nfunction _hide(el) {\n  if (el) el.classList.add('is-hidden');\n}\n\nexport function createGallery(images = []) {\n  if (!refs.gallery) return;\n\n  const markup = images\n    .map(hit => {\n      return `\n      <li class=\"photo-card\">\n        <a class=\"gallery__link\" href=\"${hit.largeImageURL}\">\n          <img class=\"gallery__image\" src=\"${hit.webformatURL}\" alt=\"${hit.tags}\" loading=\"lazy\" />\n        </a>\n        <div class=\"info\">\n          <p class=\"info-item\"><b>Likes</b><span>${hit.likes}</span></p>\n          <p class=\"info-item\"><b>Views</b><span>${hit.views}</span></p>\n          <p class=\"info-item\"><b>Comments</b><span>${hit.comments}</span></p>\n          <p class=\"info-item\"><b>Downloads</b><span>${hit.downloads}</span></p>\n        </div>\n      </li>`;\n    })\n    .join('');\n\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n\n  lightbox.refresh();\n}\n\nexport function clearGallery() {\n  if (!refs.gallery) return;\n  refs.gallery.innerHTML = '';\n}\n\nexport function showLoader() {\n  _show(refs.loader);\n}\n\nexport function hideLoader() {\n  _hide(refs.loader);\n}\n\nexport function showLoadMoreButton() {\n  _show(refs.loadMoreBtn);\n}\n\nexport function hideLoadMoreButton() {\n  _hide(refs.loadMoreBtn);\n}\n","import { getImagesByQuery } from './js/pixabay-api.js';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n} from './js/render-functions.js';\nimport iziToast from 'izitoast';\n\nconst refs = {\n  form: document.querySelector('#search-form'),\n  input: document.querySelector('#search-input'),\n  loadMoreBtn: document.querySelector('#load-more'),\n  gallery: document.querySelector('.gallery'),\n};\n\nlet currentQuery = '';\nlet currentPage = 1;\nconst PER_PAGE = 15;\n\nhideLoadMoreButton();\nhideLoader();\n\nrefs.form.addEventListener('submit', onSearch);\nrefs.loadMoreBtn.addEventListener('click', onLoadMore);\n\nasync function onSearch(e) {\n  e.preventDefault();\n\n  const query = refs.input.value.trim();\n  if (!query) {\n    clearGallery();\n    hideLoadMoreButton();\n    iziToast.warning({\n      title: 'Warning',\n      message: 'Please enter a search query.',\n      position: 'topRight',\n    });\n    return;\n  }\n\n  const isNewSearch = query.toLowerCase() !== currentQuery.toLowerCase();\n\n  if (isNewSearch) {\n    currentPage = 1;\n    clearGallery();\n  } else if (currentPage > 1) {\n    currentPage = 1;\n    clearGallery();\n  }\n\n  currentQuery = query;\n\n  hideLoadMoreButton();\n  showLoader();\n\n  try {\n    const data = await getImagesByQuery(currentQuery, currentPage);\n    const { hits = [], totalHits = 0 } = data;\n\n    if (!hits.length) {\n      iziToast.error({\n        title: 'No results',\n        message: `Sorry, there are no images matching your search query: \"${currentQuery}\". Please try again.`,\n        position: 'topRight',\n      });\n      return;\n    }\n\n    createGallery(hits);\n\n    checkEndCollection(totalHits);\n\n    iziToast.success({\n      title: 'Success',\n      message: `Found ${totalHits} images.`,\n      position: 'topRight',\n    });\n  } catch (err) {\n    console.error(err);\n    clearGallery();\n    iziToast.error({\n      title: 'Error',\n      message: 'Something went wrong. Please try again.',\n      position: 'topRight',\n    });\n  } finally {\n    hideLoader();\n    refs.form.reset();\n  }\n}\n\nasync function onLoadMore() {\n  currentPage += 1;\n  showLoader();\n  hideLoadMoreButton();\n\n  try {\n    const data = await getImagesByQuery(currentQuery, currentPage);\n    const { hits = [], totalHits = 0 } = data;\n\n    if (!hits.length) {\n      hideLoadMoreButton();\n      iziToast.info({\n        title: 'End',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n      return;\n    }\n\n    createGallery(hits);\n\n    smoothScrollAfterAppend();\n\n    checkEndCollection(totalHits);\n  } catch (err) {\n    console.error(err);\n    iziToast.error({\n      title: 'Error',\n      message: 'Failed to load more images.',\n      position: 'topRight',\n    });\n  } finally {\n    hideLoader();\n  }\n}\n\nfunction checkEndCollection(totalHits) {\n  const totalLoaded = currentPage * PER_PAGE;\n\n  if (totalHits > totalLoaded) {\n    showLoadMoreButton();\n  } else {\n    hideLoadMoreButton();\n\n    if (totalLoaded > 0 && totalHits > 0) {\n      iziToast.info({\n        title: 'End',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n    }\n  }\n}\n\nfunction smoothScrollAfterAppend() {\n  const firstCard = refs.gallery.querySelector('.photo-card');\n  if (!firstCard) return;\n\n  const addedCards = refs.gallery.querySelectorAll(\n    '.photo-card:nth-last-child(-n+15)'\n  );\n  if (addedCards.length === 0) return;\n\n  const { height } = addedCards[0].getBoundingClientRect();\n\n  window.scrollBy({\n    top: height * 2,\n    behavior: 'smooth',\n  });\n}\n"],"names":["BASE_URL","API_KEY","PER_PAGE","getImagesByQuery","query","page","url","res","error","refs","lightbox","SimpleLightbox","_show","el","_hide","createGallery","images","markup","hit","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","currentQuery","currentPage","onSearch","onLoadMore","e","iziToast","data","hits","totalHits","checkEndCollection","err","smoothScrollAfterAppend","totalLoaded","addedCards","height"],"mappings":"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"}